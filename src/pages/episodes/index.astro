---
import Layout from '../../components/Layout.astro';
import { getCollection } from 'astro:content';

const episodes = await getCollection('episodes');
const sortedEpisodes = episodes.sort((a, b) => {
  const dateDiff = b.data.publishDate.getTime() - a.data.publishDate.getTime();
  if (dateDiff !== 0) return dateDiff;
  return (b.data.episodeNumber ?? 0) - (a.data.episodeNumber ?? 0);
});
---

<Layout title="All Episodes">
  <div class="max-w-7xl mx-auto px-4 py-8">
    <header class="mb-8">
      <h1 class="text-4xl font-bold text-text-light mb-4">All Episodes</h1>
      <p class="text-lg text-text-light/80">
        Watch the full collection of historical cooking adventures
      </p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {sortedEpisodes.map((episode) => (
        <article class="bg-surface border border-border rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
          <div class="aspect-video bg-background/20">
            <iframe
              class="w-full h-full"
              src={`https://www.youtube.com/embed/${episode.data.youtubeId}`}
              title={episode.data.title}
              frameborder="0"
              allowfullscreen>
            </iframe>
          </div>
          <div class="p-6">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm text-primary font-medium">
                Episode {episode.data.episodeNumber}
              </span>
              <time class="text-sm text-muted">
                {episode.data.publishDate.toLocaleDateString()}
              </time>
            </div>
            <h3 class="text-xl font-bold mb-3">
              <a href={`/episodes/${episode.slug}`} class="text-text-light hover:text-primary transition-colors">
                {episode.data.title}
              </a>
            </h3>
            <p class="text-text-light/80 mb-3 font-medium">
              {episode.data.historicalFigure}
            </p>
            <p class="text-text-light/70 text-sm mb-4 line-clamp-3">
              {episode.data.description}
            </p>
            <a 
              href={`/episodes/${episode.slug}`}
              class="inline-block bg-primary text-text-dark px-4 py-2 rounded font-medium hover:bg-accent transition-colors"
            >
              Watch Episode
            </a>
          </div>
        </article>
      ))}
    </div>

    {episodes.length === 0 && (
      <div class="text-center py-16">
        <p class="text-muted text-lg">No episodes found. Check back soon for new content!</p>
      </div>
    )}
  </div>
</Layout>
